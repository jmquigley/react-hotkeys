/**
 * ISC License
 *
 * Copyright (c) 2018, Aleck Greenham
 *
 * Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["exports","prop-types","react"],t):t((e=e||self).ReactHotkeys={},e.PropTypes,e.React)}(this,function(e,u,l){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u;var c="default"in l?l.default:l;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_(t,e,n[e])})}return t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t,n){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&r(i,n.prototype),i}).apply(null,arguments)}function s(e){var n="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return i(e,arguments,v(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)})(e)}function f(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?g(e):t}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(i)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function C(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return e.reduce(function(e,t){return e[t]=n||{value:t},e},{})}var n={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],enableHardSequences:!1,ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(e){var t=e.target;if(t&&t.tagName){var n=t.tagName.toLowerCase();return I.option("_ignoreTagsDict")[n]||t.isContentEditable}return!1},simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0},K=b({},n);K._ignoreTagsDict=E(K.ignoreTags,!0);var I=(y(S,null,[{key:"init",value:function(t){var n=this;t.ignoreTags&&(t._ignoreTagsDict=E(t.ignoreTags)),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach(function(e){n.set(e,t[e])})}},{key:"set",value:function(e,t){K[e]=t}},{key:"reset",value:function(e){K[e]=n[e]}},{key:"option",value:function(e){return K[e]}}]),S);function S(){h(this,S)}var w=(y(O,[{key:"noop",value:function(){}}]),O);function O(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";h(this,O),_(this,"verbose",this.noop),_(this,"debug",this.noop),_(this,"info",this.noop),_(this,"warn",this.noop),_(this,"error",this.noop),this.logLevel=this.constructor.levels[e],this.logLevel>=this.constructor.levels.error&&(this.error=console.error,this.logLevel>=this.constructor.levels.warn&&(this.warn=console.warn,["info","debug","verbose"].some(function(e){return!(t.logLevel>=t.constructor.levels[e])||(t[e]=console.log,!1)})))}function P(e){return void 0===e}_(w,"logIcons",["üìï","üìó","üìò","üìô"]),_(w,"componentIcons",["üî∫","‚≠êÔ∏è","üî∑","üî∂","‚¨õÔ∏è"]),_(w,"eventIcons",["‚ù§Ô∏è","üíö","üíô","üíõ","üíú","üß°"]),_(w,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var M=(y(H,null,[{key:"newBitmap",value:function(e){var t=[!1,!1,!1];if(!P(e))for(var n=0;n<=e;n++)t[n]=!0;return t}},{key:"setBit",value:function(e,t){return e[t]=!0,e}},{key:"clone",value:function(e){for(var t=this.newBitmap(),n=0;n<e.length;n++)t[n]=e[n];return t}},{key:"and",value:function(e,t){for(var n=[],o=0;o<e.length;o++)n[o]=e[o]&t[o];return n}}]),H);function H(){h(this,H)}var T={keydown:0,keypress:1,keyup:2},A={"`":["~"],1:["!"],2:["@",'"'],3:["#","¬£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function x(e){return A[e]||[1===e.length?e.toUpperCase():e]}function D(e,t){return e.hasOwnProperty(t)}function B(o){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(o).reduce(function(t,n){var e=o[n];return e.forEach(function(e){D(t,e)||(t[e]=[]),t[e].push(n)}),i.includeOriginal&&(D(t,n)||(t[n]=[]),t[n]=[].concat(C(t[n]),C(e))),t},{})}var L=B(A);function j(e){return L[e]||[1===e.length?e.toLowerCase():e]}var F=B({},{includeOriginal:!0});function q(e){return"string"==typeof e}var R={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Delete",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},U={cmd:"Meta"};function N(e){var t=e.toLowerCase();return R[t]||U[t]||(e.match(/^f\d+$/)?e.toUpperCase():e)}var G={Shift:!0,Control:!0,Alt:!0,Meta:!0,Enter:!0,Tab:!0,CapsLock:!0,BackSpace:!0,Escape:!0};function z(e){return function(e){return!!G[e]}(e)||String.fromCharCode(e.charCodeAt(0))===e}var W=(d(V,s(Error)),V);function V(){return h(this,V),m(this,v(V).apply(this,arguments))}function $(e){return e.sort().join("+")}var Y=(y(J,null,[{key:"parse",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=function(e){return q(e)?e.trim().replace(/\s+/g," "):e}(e).split(" ");try{var o=t.slice(0,t.length-1),i=t[t.length-1],r=o.map(function(e){var t=Q(e,n);return $(Object.keys(t))}).join(" "),s=Q(i,n),a={id:$(Object.keys(s)),keyDictionary:s,eventBitmapIndex:n.eventBitmapIndex,size:Object.keys(s).length};return{sequence:{prefix:r,size:o.length+1},combination:a}}catch(e){return{sequence:null,combination:null}}}}]),J);function J(){h(this,J)}function Q(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce(function(e,t){var n=N(t);if(o.ensureValidKeys&&!z(n))throw new W;return e[n]=!0,e},{})}var X={"`":["`"],1:["¬°"],2:["‚Ñ¢"],3:["¬£"],4:["¬¢"],5:["‚àû"],6:["¬ß"],7:["¬∂"],8:["‚Ä¢"],9:["¬™"],0:["¬∫"],"-":["‚Äì"],"=":["‚â†"],a:["√•"],b:["‚à´"],c:["√ß"],d:["‚àÇ"],e:["¬¥"],f:["∆í"],g:["¬©"],h:["Àô"],i:["ÀÜ"],j:["‚àÜ"],k:["Àö"],l:["¬¨"],m:["¬µ"],n:["Àú"],o:["√∏"],p:["œÄ"],q:["≈ì"],r:["¬Æ"],s:["√ü"],t:["‚Ä†"],u:["¬®"],v:["‚àö"],w:["‚àë"],x:["‚âà"],y:["¬•"],z:["Œ©"],"[":["‚Äú"],"]":["‚Äò"],"\\":["¬´"],"'":["√¶"],";":["‚Ä¶"],",":["‚â§"],".":["‚â•"],"/":["√∑"]},Z=B(X);function ee(e){return Z[e]||[e]}function te(e){return X[e]||[e]}var ne={"`":["`"],1:["‚ÅÑ"],2:["‚Ç¨"],3:["‚Äπ"],4:["‚Ä∫"],5:["Ô¨Å"],6:["Ô¨Ç"],7:["‚Ä°"],8:["¬∞"],9:["¬∑"],0:["‚Äö"],"-":["‚Äî"],"=":["¬±"],a:["√Ö"],b:["ƒ±"],c:["√á"],d:["√é"],e:["¬¥"],f:["√è"],g:["Àù"],h:["√ì"],i:["ÀÜ"],j:["√î"],k:["Ô£ø"],l:["√í"],m:["√Ç"],n:["Àú"],o:["√ò"],p:["œÄ"],q:["≈í"],r:["‚Ä∞"],s:["√ç"],t:["√é"],u:["¬®"],v:["‚óä"],w:["‚Äû"],x:["Àõ"],y:["√Å"],z:["¬∏"],"[":["‚Äù"],"]":["‚Äô"],"\\":["¬ª"],"'":["√Ü"],";":["√ö"],",":["¬Ø"],".":["Àò"]},oe=B(ne);function ie(e){return oe[e]||j(e)}function re(e){return ne[e]||[e]}var se=(y(ae,null,[{key:"serialize",value:function(e){var c=e.Shift,h=e.Alt,y={};return Object.keys(e).sort().forEach(function(e){var n=[];if(c)if(h){var t=ie(e),o=re(e);n=[].concat(C(n),[e],C(t),C(o))}else{var i=j(e),r=x(e);n=[].concat(C(n),[e],C(i),C(r))}else if(h){var s=ee(e),a=te(e);n=[].concat(C(n),[e],C(s),C(a))}else{n.push(e);var u=F[e];u&&(n=[].concat(C(n),C(u)))}var l=Object.keys(y);0<l.length?l.forEach(function(t){n.forEach(function(e){y[t+"+".concat(e)]=b({},y[t],_({},e,!0))}),delete y[t]}):n.forEach(function(e){y[e]=_({},e,!0)})}),Object.values(y).map(function(e){return Object.keys(e).sort().join("+")})}},{key:"isValidKeySerialization",value:function(e){return 0<e.length&&!!Y.parse(e,{ensureValidKeys:!0}).combination}}]),ae);function ae(){h(this,ae)}function ue(e){return Array.isArray(e)?e:e?[e]:[]}function le(e,t){return e[e.length-(t+1)]}function ce(e){return!Array.isArray(e)&&"object"===t(e)&&null!==e}function he(e){return ce(e)?0===Object.keys(e).length:!e||0===e.length}function ye(e){switch(parseInt(e,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}var pe=0,de=1;var ve={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]};for(var fe={Shift:!0,Control:!0,Alt:!0,Meta:!0,Enter:!0,Tab:!0,BackSpace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},ge=1;ge<13;ge++)fe["F".concat(ge)]=!0;var me=(y(ke,null,[{key:"emptyKeyCombination",value:function(){return{keys:{},ids:[""],keyAliases:{}}}}]),y(ke,[{key:"_reset",value:function(){this._initRegisteredKeyMapsState(),this._initHandlerResolutionState()}},{key:"_initRegisteredKeyMapsState",value:function(){this.componentList=[],this.longestSequence=1,this.longestSequenceComponentIndex=null,this.keyMapEventBitmap=M.newBitmap(),this.componentIdDict={}}},{key:"_initHandlerResolutionState",value:function(){this.keyMaps=null,this.handlerResolutionSearchIndex=0,this.unmatchedHandlerStatus=null,this.handlersDictionary={},this.keySequencesDictionary={}}},{key:"resetKeyCombinationHistory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this.keyCombinationIncludesKeyUp=!1,this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[],!this.keyCombinationHistory||this.keyCombinationHistory.length<1||e.force)this.keyCombinationHistory=[];else{var i=this._getCurrentKeyCombination(),t=Object.keys(i.keys).reduce(function(e,t){var n=i.keys[t],o=n[de];return o[T.keydown]&&!o[T.keyup]&&(e[t]=n),e},{});this.keyCombinationHistory=[{keys:t,ids:se.serialize(t),keyAliases:this._buildCombinationKeyAliases(t)}]}}},{key:"getApplicationKeyMap",value:function(){return null===this.rootComponentId?{}:this._buildApplicationKeyMap([this.rootComponentId],{})}},{key:"_buildApplicationKeyMap",value:function(e,i){var n=this;return e.forEach(function(e){var t=n.componentRegistry[e],o=n.keyMapRegistry[e];o&&Object.keys(o).forEach(function(n){i[n]=[],ue(o[n]).forEach(function(e){var t=ce(e)?e.sequence:e;i[n].push(t)})}),n._buildApplicationKeyMap(t.childIds,i)}),i}},{key:"registerKeyMap",value:function(e){return this.componentId+=1,this.keyMapRegistry[this.componentId]=e,this.componentRegistry[this.componentId]={childIds:[],parentId:null},this.componentId}},{key:"reregisterKeyMap",value:function(e,t){this.keyMapRegistry[e]=t}},{key:"registerComponentMount",value:function(e,t){P(t)?this.rootComponentId=e:(this.componentRegistry[e].parentId=t,this.componentRegistry[t].childIds.push(e))}},{key:"deregisterKeyMap",value:function(e){var t=this.componentRegistry[e].parentId,n=this.componentRegistry[t];n&&(n.childIds=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=E(ue(e));return Array.isArray(n)?n.reduce(function(e,t){return i[t]&&(o.stringifyFirst||i[t].value===t)||e.push(t),e},[]):ce(n)?Object.keys(n).reduce(function(e,t){return i[t]||(e[t]=n[t]),e},{}):n}(n.childIds,e)),delete this.componentRegistry[e],delete this.keyMapRegistry[e],e===this.rootComponentId&&(this.rootComponentId=null)}},{key:"_addComponentToList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0,i=this._buildComponentOptions(e,t,n,o);this.componentList.push(i),this._setComponentPosition(e,this.componentList.length-1)}},{key:"_buildComponentOptions",value:function(e,t,n,o){var i=this._applyHardSequences(t,n),r=i.keyMap,s=i.handlers;return{actions:this._buildActionDictionary(b({},t,r),o,e),handlers:s,componentId:e,options:o}}},{key:"_applyHardSequences",value:function(n,o){return I.option("enableHardSequences")?Object.keys(o).reduce(function(e,t){return!n[t]&&se.isValidKeySerialization(t)&&(e.keyMap[t]=t),e.handlers[t]=o[t],e},{keyMap:{},handlers:{}}):{keyMap:n,handlers:o}}},{key:"_buildActionDictionary",value:function(e,l,c){var h=this;return Object.keys(e).reduce(function(a,u){return ue(e[u]).forEach(function(n){var e=function(){if(ce(n)){var e=n.sequence,t=n.action;return{keySequence:e,eventBitmapIndex:P(t)?T[l.defaultKeyEvent]:T[t]}}return{keySequence:n,eventBitmapIndex:T[l.defaultKeyEvent]}}(),t=e.keySequence,o=e.eventBitmapIndex,i=Y.parse(t,{eventBitmapIndex:o}),r=i.sequence,s=i.combination;r.size>h.longestSequence&&(h.longestSequence=r.size,h.longestSequenceComponentIndex=c),M.setBit(h.keyMapEventBitmap,o),a[u]||(a[u]=[]),a[u].push(b({prefix:r.prefix,actionName:u,sequenceLength:r.size},s))}),a},{})}},{key:"_getCurrentKeyCombination",value:function(){return 0<this.keyCombinationHistory.length?this.keyCombinationHistory[this.keyCombinationHistory.length-1]:this.constructor.emptyKeyCombination()}},{key:"_addToCurrentKeyCombination",value:function(e,t){0===this.keyCombinationHistory.length&&this.keyCombinationHistory.push(this.constructor.emptyKeyCombination());var n=this._getCurrentKeyCombination(),o=be(n,e),i=Ce(n,e);n.keys[o]=i?[M.clone(i[1]),M.newBitmap(t)]:[M.newBitmap(),M.newBitmap(t)],n.ids=se.serialize(n.keys),n.keyAliases=this._buildCombinationKeyAliases(n.keys),t===T.keyup&&(this.keyCombinationIncludesKeyUp=!0)}},{key:"_startNewKeyCombination",value:function(e,t){this.keyCombinationHistory.length>this.longestSequence&&this.keyCombinationHistory.shift();var n=this._getCurrentKeyCombination(),o=b({},this._withoutKeyUps(n),_({},e,[M.newBitmap(),M.newBitmap(t)]));this.keyCombinationHistory.push({keys:o,ids:se.serialize(o),keyAliases:this._buildCombinationKeyAliases(o)}),this.keyCombinationIncludesKeyUp=!1}},{key:"_withoutKeyUps",value:function(o){return Object.keys(o.keys).reduce(function(e,t){var n=o.keys[t];return n[de][T.keyup]||(e[t]=n),e},{})}},{key:"_shouldSimulate",value:function(e,t){var n=function(e){return!fe[e]}(t);return e===T.keypress?!n||n&&this._keyIsCurrentlyDown("Meta"):e===T.keyup&&n&&_e(this._getCurrentKeyState("Meta"),T.keyup)}},{key:"_cloneAndMergeEvent",value:function(n,e){return b({},Object.keys(ve).reduce(function(e,t){return e[t]=n[t],e},{}),e)}},{key:"_callMatchingHandlerClosestToEventTarget",value:function(e,t,n,o,i){var p=this;for(this.keyMaps&&this.unmatchedHandlerStatus||(this.keyMaps=[],this.unmatchedHandlerStatus=[],this.componentList.forEach(function(e){var t=e.handlers;p.unmatchedHandlerStatus.push([Object.keys(t).length,{}]),p.keyMaps.push({})}));i<=o;){var r=this.unmatchedHandlerStatus[i][0];if(0<r)for(var s=function(){var e=p.componentList[p.handlerResolutionSearchIndex],t=e.handlers,o=e.actions;Object.keys(t).forEach(function(e){p.handlersDictionary[e]||(p.handlersDictionary[e]=[]),p.handlersDictionary[e].push(p.handlerResolutionSearchIndex)}),Object.keys(o).forEach(function(n){var e=p.handlersDictionary[n];if(e){var c=e[0],h=p.componentList[c].handlers[n],y=p.keyMaps[c];y.sequences||(y.sequences={}),o[n].forEach(function(t){var e=[t.prefix,t.id].join(" ");if(!p.keySequencesDictionary[e]||!p.keySequencesDictionary[e].some(function(e){return e[1]===t.eventBitmapIndex})){y.sequences[t.prefix]||(y.sequences[t.prefix]={combinations:{}});var n=t.prefix,o=t.sequenceLength,i=t.id,r=t.keyDictionary,s=t.size,a=t.eventBitmapIndex,u=t.actionName,l=y.sequences[t.prefix].combinations[t.id];y.sequences[t.prefix].combinations[t.id]=l?b({},l,{events:b({},l.events,_({},a,{actionName:u,eventBitmapIndex:a,handler:h}))}):{prefix:n,sequenceLength:o,id:i,keyDictionary:r,size:s,events:_({},a,{actionName:u,eventBitmapIndex:a,handler:h})},y.eventBitmap||(y.eventBitmap=M.newBitmap()),M.setBit(y.eventBitmap,t.eventBitmapIndex),(!y.longestSequence||y.longestSequence<t.sequenceLength)&&(y.longestSequence=t.sequenceLength),p.keySequencesDictionary[e]||(p.keySequencesDictionary[e]=[]),p.keySequencesDictionary[e].push([c,t.eventBitmapIndex])}}),e.forEach(function(e){var t=p.unmatchedHandlerStatus[e];t[1][n]||(t[1][n]=!0,t[0]--)})}}),p.handlerResolutionSearchIndex++};this.handlerResolutionSearchIndex<this.componentList.length&&0<r;)s();var a=this.keyMaps[i];if(a&&!he(a.sequences)&&a.eventBitmap[n])for(var u=a.sequences,l=a.longestSequence,c=this._getCurrentKeyCombination(),h=be(c,t),y=l;0<=y;){var d=this.keyCombinationHistory.slice(-y,-1).map(function(e){return e.ids}),v=this._tryMatchSequenceWithKeyAliases(u,d);if(v){v.order||function(){var n=Object.values(v.combinations).reduce(function(e,t){var n=t.id,o=t.size;return e[o]||(e[o]=[]),e[o].push(n),e},{});v.order=Object.keys(n).sort(function(e,t){return t-e}).reduce(function(e,t){return e.concat(n[t])},[])}();for(var f=v.order,g=0;g<f.length;){var m=f[g],k=v.combinations[m];if(this._combinationMatchesKeys(h,c,k,n))return se.serialize(k.keyDictionary),k.events[n].handler(e),this._stopEventPropagationAfterHandlingIfEnabled(e,i),!0;g++}}y--}i++}}},{key:"_stopEventPropagationAfterHandlingIfEnabled",value:function(e,t){return!!I.option("stopEventPropagationAfterHandling")&&(this._stopEventPropagation(e,t),!0)}},{key:"_stopEventPropagationAfterIgnoringIfEnabled",value:function(e,t){return!!I.option("stopEventPropagationAfterIgnoring")&&(this._stopEventPropagation(e,t),!0)}},{key:"_describeCurrentKeyCombination",value:function(){return this._getCurrentKeyCombination().ids[0]}},{key:"_tryMatchSequenceWithKeyAliases",value:function(e,n){if(0===n.length)return e[""];for(var t=n.map(function(e){return e.length}),o=n.map(function(){return 0}),i=!1;!i;){var r=o.map(function(e,t){return n[t][e]}).join(" ");if(e[r])return e[r];for(var s=0,a=!0;a&&s<o.length;){var u=(le(o,s)+1)%(le(t,s)||1);(a=0==(o[o.length-(s+1)]=u))&&s++}i=s===o.length}}},{key:"_combinationMatchesKeys",value:function(n,o,e,i){if(!e.events[i])return!1;var r=!1;return!Object.keys(e.keyDictionary).some(function(e){var t=Ce(o,e);return!t||!_e(t,i)||(n&&n===be(o,e)&&(r=!function(e,t){return e&&e[pe][t]}(t,i)),!1)})&&r}},{key:"_checkForModifierFlagDiscrepancies",value:function(o){var i=this;Object.keys(ve).forEach(function(t){var n=i._keyIsCurrentlyDown(t);ve[t].forEach(function(e){!1===o[e]&&n&&i._addToCurrentKeyCombination(t,T.keyup)})})}},{key:"_keyIsCurrentlyDown",value:function(e){var t=this._getCurrentKeyState(e);return!(!_e(t,T.keypress)||_e(t,T.keyup))}},{key:"_getCurrentKeyState",value:function(e){return Ce(this._getCurrentKeyCombination(),e)}},{key:"_buildCombinationKeyAliases",value:function(t){var e=function(){if(t.Shift)return t.Alt?[re,ie]:[x,j];if(t.Alt)return[te,ee];function e(e){return[e]}return[e,e]}();return Object.keys(t).reduce(function(n,o){return function(e){return F[e]||[e]}(o).forEach(function(t){e.forEach(function(e){e(t).forEach(function(e){e===o&&o===t||(n[e]=o)})})}),n},{})}},{key:"_setComponentPosition",value:function(e,t){this.componentIdDict[e]=t}},{key:"_getComponentPosition",value:function(e){return this.componentIdDict[e]}},{key:"_getComponent",value:function(e){var t=this._getComponentPosition(e);return this.componentList[t]}},{key:"_getComponentAndPosition",value:function(e){var t=this._getComponentPosition(e);return[this.componentList[t],t]}},{key:"_logPrefix",value:function(){}}]),ke);function ke(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;h(this,ke),this.logger=e.logger||new w("warn"),this.componentId=-1,this.keyEventManager=t,this.keyMapRegistry={},this.componentRegistry={},this.rootComponentId=null,this._reset(),this.resetKeyCombinationHistory()}function _e(e,t){return e&&e[de][t]}function be(e,t){if(e.keys[t])return t;var n=e.keyAliases[t];return n||t}function Ce(e,t){var n=e.keys[t];if(n)return n;var o=e.keyAliases[t];return o?e.keys[o]:void 0}var Ee=(y(Ke,null,[{key:"getId",value:function(){return P(this.id)&&(this.id=0),this.id}},{key:"incrementId",value:function(){this.id=this.getId()+1}}]),Ke);function Ke(){h(this,Ke)}function Ie(e){return"+"===e?"plus":e}function Se(e){return"Meta"===e}var we=0,Oe=1,Pe=2,Me=4,He=(d(Te,me),y(Te,[{key:"_reset",value:function(){a(v(Te.prototype),"_reset",this).call(this),this.keypressEventsToSimulate=[],this.focusTreeId+=1,this._clearEventPropagationState()}},{key:"_clearEventPropagationState",value:function(){this.eventPropagationState={previousComponentPosition:-1,actionHandled:!1,ignoreEvent:!1,forceObserveEvent:!1,stopping:!1}}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;return(this.resetOnNextFocus||this.keyMaps)&&(this._reset(),this.resetOnNextFocus=!1),this._addComponentToList(e,t,n,o),this._getComponent(e),this.focusTreeId}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0,r=this._getComponentPosition(t);e!==this.focusTreeId||P(r)||(this.componentList[r]=this._buildComponentOptions(t,n,o,i),this._getComponent(t))}},{key:"disableHotKeys",value:function(e,t){this.resetOnNextFocus||(this.resetOnNextFocus=!0);var n=this._getComponentPosition(t),o=this.eventPropagationState.previousComponentPosition;return-1!==o&&o+1<n}},{key:"handleKeydown",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=Ie(e.key);return t!==this.focusTreeId?(this._ignoreEvent(e,n),!0):(this._howToHandleKeyDownEvent(e,t,n,i,o,T.keydown)===Me&&(this._getCurrentKeyState(i)||this.keyCombinationIncludesKeyUp?this._startAndLogNewKeyCombination(i,T.keydown,t,n):this._addToAndLogCurrentKeyCombination(i,T.keydown,t,n),this._callHandlerIfActionNotHandled(e,i,T.keydown,n,t)),this._simulateKeyPressesMissingFromBrowser(e,i,t,n,o),this._updateEventPropagationHistory(n),!1)}},{key:"_howToHandleKeyDownEvent",value:function(e,t,n,o,i,r){if(this._shouldIgnoreEvent())return this._ignoreEvent(e,n),Oe;if(this._isNewKeyEvent(n)){if(this._setNewEventParameters(e,r),this._setIgnoreEventFlag(e,i),this._shouldIgnoreEvent())return this._ignoreEvent(e,n),Oe;this._checkForModifierFlagDiscrepancies(e)}return Me}},{key:"handleKeypress",value:function(e,t,n,o){var i=Ie(e.key),r=t!==this.focusTreeId,s=this._howToHandleKeyDownEvent(e,t,n,i,o,T.keypress);return this._isNewKeyEvent(n)&&this._getCurrentKeyState(i)&&this._addToAndLogCurrentKeyCombination(i,T.keypress,t,n),s===Me&&this._callHandlerIfActionNotHandled(e,i,T.keypress,n,t),this._updateEventPropagationHistory(n),r}},{key:"handleKeyup",value:function(e,t,n,o){var i=Ie(e.key),r=t!==this.focusTreeId,s=this._howToHandleKeyDownEvent(e,t,n,i,o,T.keyup);return this._isNewKeyEvent(n)&&this._getCurrentKeyState(i)&&this._addToAndLogCurrentKeyCombination(i,T.keyup,t,n),s===Me&&this._callHandlerIfActionNotHandled(e,i,T.keyup,n,t),this._simulateKeyUpEventsHiddenByCmd(e,i,t,n,o),this._updateEventPropagationHistory(n),r}},{key:"_simulateKeyPressesMissingFromBrowser",value:function(e,t,n,o,i){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",this._shouldSimulate(T.keypress,t),{event:e,key:t,focusTreeId:n,componentId:o,options:i})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,o,i){var r=this;Se(e)&&Object.keys(this._getCurrentKeyCombination().keys).forEach(function(e){Se(e)||r._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",r._shouldSimulate(T.keyup,e),{event:t,key:e,focusTreeId:n,componentId:o,options:i})})}},{key:"_ignoreEvent",value:function(e,t){this.currentEvent.ignored=!0,this._stopEventPropagationAfterIgnoringIfEnabled(e,t)?this._updateEventPropagationHistory(t,{forceReset:!0}):this._updateEventPropagationHistory(t)}},{key:"_shouldIgnoreEvent",value:function(){var e=this.eventPropagationState,t=e.ignoreEvent;return!e.forceObserveEvent&&t}},{key:"_isNewKeyEvent",value:function(e){var t=this.eventPropagationState.previousComponentPosition;return-1===t||t>=this._getComponentPosition(e)}},{key:"_updateEventPropagationHistory",value:function(e){(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{forceReset:!1}).forceReset||this._isFocusTreeRoot(e)?this._clearEventPropagationState():this.eventPropagationState.previousComponentPosition=this._getComponentPosition(e)}},{key:"_setIgnoreEventFlag",value:function(e,t){this.eventPropagationState.ignoreEvent=t.ignoreEventsCondition(e)}},{key:"ignoreEvent",value:function(){this.eventPropagationState.ignoreEvent=!0}},{key:"forceObserveEvent",value:function(){this.eventPropagationState.forceObserveEvent=!0}},{key:"_isFocusTreeRoot",value:function(e){return this._getComponentPosition(e)>=this.componentList.length-1}},{key:"_setNewEventParameters",value:function(e,t){Ee.incrementId(),this.currentEvent={key:e.key,type:t,handled:!1,ignored:!1}}},{key:"_startAndLogNewKeyCombination",value:function(e,t,n,o){this._startNewKeyCombination(e,t)}},{key:"_addToAndLogCurrentKeyCombination",value:function(e,t,n,o){this._addToCurrentKeyCombination(e,t)}},{key:"_stopEventPropagation",value:function(e,t){this.eventPropagationState.stopping||(this.eventPropagationState.stopping=!0,e.simulated||e.stopPropagation())}},{key:"_handleEventSimulation",value:function(e,t,n,o){var i=o.event,r=o.key,s=o.focusTreeId,a=o.componentId,u=o.options;if(n&&I.option("simulateMissingKeyPressEvents")){var l=this._cloneAndMergeEvent(i,{key:r,simulated:!0});this[e].push({event:l,focusTreeId:s,componentId:a,options:u})}(this._isFocusTreeRoot(a)||this.eventPropagationState.stopping)&&(this.keyEventManager.isGlobalListenersBound()||this[t]())}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeypress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyup")}},{key:"_simulatePendingKeyEvents",value:function(e,r){var s=this;0<this[e].length&&Ee.incrementId(),this[e].forEach(function(e){var t=e.event,n=e.focusTreeId,o=e.componentId,i=e.options;s[r](t,n,o,i)}),this[e]=[],this._clearEventPropagationState()}},{key:"_callHandlerIfActionNotHandled",value:function(e,t,n,o,i){if(this._describeCurrentKeyCombination(),this.keyMapEventBitmap[n])if(this.eventPropagationState.actionHandled);else{var r=this.eventPropagationState.previousComponentPosition,s=this._getComponentPosition(o);this._callMatchingHandlerClosestToEventTarget(e,t,n,s,-1===r?0:r)&&(this.eventPropagationState.actionHandled=!0,this.currentEvent.handled=!0)}}},{key:"_logPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=w.logIcons,o=w.eventIcons,i=w.componentIcons,r="HotKeys (";if(!1!==t.focusTreeId){var s=P(t.focusTreeId)?this.focusTreeId:t.focusTreeId;r+="F".concat(s).concat(n[s%n.length],"-")}if(!1!==t.eventId){var a=P(t.eventId)?Ee.getId():t.eventId;r+="E".concat(a).concat(o[a%o.length],"-")}r+="C".concat(e).concat(i[e%i.length]);var u=this._getComponentPosition(e);return P(u)||(r+="-P".concat(u).concat(i[u%i.length],":")),"".concat(r,")")}}]),Te);function Te(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return h(this,Te),(e=m(this,v(Te).call(this,t,n))).focusTreeId=0,e.currentEvent={key:null,type:null,handled:!1,ignored:!1},e}var Ae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function De(e){if(e.key){var t=Ae[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"!==e.type)return"keydown"===e.type||"keyup"===e.type?xe[e.keyCode]||"Unidentified":"";var n=function(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,10===t&&(t=13),32<=t||13===t?t:0}(e);return 13===n?"Enter":String.fromCharCode(n)}function Be(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(e)||q(e)?n.stringifyFirst?!P(e.find(function(e){return e.toString()===t.toString()})):-1!==e.indexOf(t):ce(e)?D(e,t):n.stringifyFirst?e.toString()===t.toString():e===t}var Le=(d(je,me),y(je,[{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;this.eventOptions=i,this._addComponentToList(e,t,n,o),this._updateDocumentHandlers()}},{key:"updateEnabledHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;this.eventOptions=i;var r=this._getComponentPosition(e);this.componentList[r]=this._buildComponentOptions(e,t,n,o),this._updateLongestKeySequenceIfNecessary(e),this._updateDocumentHandlers(),this._initHandlerResolutionState()}},{key:"disableHotKeys",value:function(e){var t=k(this._getComponentAndPosition(e),2),n=t[0].keyMapEventBitmap,o=t[1];this.componentList=function(e,t){return[].concat(C(e.slice(0,t)),C(e.slice(t+1)))}(this.componentList,o),this._updateLongestKeySequenceIfNecessary(e),this._updateComponentIndexDictFromList({startingAt:o}),this._updateDocumentHandlers(n,M.newBitmap()),this._initHandlerResolutionState()}},{key:"_updateLongestKeySequenceIfNecessary",value:function(e){var n=this;e===this.longestSequenceComponentIndex&&(this.longestSequence=1,this.componentList.forEach(function(e){var t=e.longestSequence;t>n.longestSequence&&(n.longestSequence=t)}))}},{key:"_updateComponentIndexDictFromList",value:function(){for(var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{startingAt:0}).startingAt;e<this.componentList.length;)this._setComponentPosition(this.componentList[e].componentId,e),e++}},{key:"_updateDocumentHandlers",value:function(){var n=this,e=this.keyMapEventBitmap.some(function(e){return e});if(!this.listenersBound&&e){for(var t=function(e){var t=ye(e);document["on".concat(t)]=function(e){n.keyEventManager["handleGlobal".concat(function(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}(t))](e)}},o=0;o<this.keyMapEventBitmap.length;o++)t(o);this.listenersBound=!0}else if(this.listenersBound&&!e){for(o=0;o<this.keyMapEventBitmap.length;o++){var i=ye(o);delete document["on".concat(i)]}this.listenersBound=!1}}},{key:"handleKeydown",value:function(e){this._checkForModifierFlagDiscrepancies(e);var t=Ie(De(e)),n=this._howReactAppRespondedTo(e,t,T.keydown);n===we&&this.eventOptions.ignoreEventsCondition(e)||(n!==Oe&&(this._getCurrentKeyState(t)||this.keyCombinationIncludesKeyUp?this._startAndLogNewKeyCombination(t,T.keydown):this._addToAndLogCurrentKeyCombination(t,T.keydown)),Be([Oe,Me],n)||this._callHandlerIfExists(e,t,T.keydown),this._simulateKeyPressesMissingFromBrowser(e,t))}},{key:"_howReactAppRespondedTo",value:function(e,t,n){var o=this.keyEventManager.reactAppHistoryWithEvent(t,n);switch(o){case Me:case Oe:case Pe:break;default:Ee.incrementId()}return o}},{key:"handleKeypress",value:function(e){var t=Ie(De(e)),n=this._howReactAppRespondedTo(e,t,T.keypress);this._getCurrentKeyState(t)&&this._addToAndLogCurrentKeyCombination(t,T.keypress),n===we&&this.eventOptions.ignoreEventsCondition(e)||Be([Oe,Me],n)||this._callHandlerIfExists(e,t,T.keypress)}},{key:"handleKeyup",value:function(e){var t=Ie(De(e)),n=this._howReactAppRespondedTo(e,t,T.keyup);this._getCurrentKeyState(t)&&this._addToAndLogCurrentKeyCombination(t,T.keyup),n===we&&this.eventOptions.ignoreEventsCondition(e)||Be([Oe,Me],n)||this._callHandlerIfExists(e,t,T.keyup),this._simulateKeyUpEventsHiddenByCmd(e,t)}},{key:"_simulateKeyPressesMissingFromBrowser",value:function(e,t){this.keyEventManager.simulatePendingKeyPressEvents(),this._handleEventSimulation("handleKeypress",this._shouldSimulate(T.keypress,t),{event:e,key:t})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;Se(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),Object.keys(this._getCurrentKeyCombination().keys).forEach(function(e){Se(e)||n._handleEventSimulation("handleKeyup",n._shouldSimulate(T.keyup,e),{event:t,key:e})}))}},{key:"_startAndLogNewKeyCombination",value:function(e,t){this._startNewKeyCombination(e,t)}},{key:"_addToAndLogCurrentKeyCombination",value:function(e,t){this._addToCurrentKeyCombination(e,t)}},{key:"_handleEventSimulation",value:function(e,t,n){var o=n.event,i=n.key;if(t&&I.option("simulateMissingKeyPressEvents")){var r=this._cloneAndMergeEvent(o,{key:i,simulated:!0});this[e](r)}}},{key:"_callHandlerIfExists",value:function(e,t,n){this._describeCurrentKeyCombination(),this.keyMapEventBitmap[n]&&this._callMatchingHandlerClosestToEventTarget(e,t,n)}},{key:"_callMatchingHandlerClosestToEventTarget",value:function(e,t,n){for(var o=0;o<this.componentList.length;o++)if(a(v(je.prototype),"_callMatchingHandlerClosestToEventTarget",this).call(this,e,t,n,o,0))return}},{key:"_stopEventPropagation",value:function(e,t){e.simulated||e.stopPropagation()}},{key:"_logPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=w.eventIcons,o=w.componentIcons,i="HotKeys (GLOBAL";if(!1!==t.eventId){var r=P(t.eventId)?Ee.getId():t.eventId;i="".concat(i,"-E").concat(r).concat(n[r%n.length])}return P(e)?"".concat(i,"):"):"".concat(i,"-C").concat(e).concat(o[e%o.length],"):")}}]),je);function je(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return h(this,je),(e=m(this,v(je).call(this,t,n))).listenersBound=!1,e.eventOptions={ignoreEventsCondition:I.option("ignoreEventsCondition")},e}function Fe(e){return!P(e)}var qe=(y(Re,null,[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.instance||(this.instance=new Re(e)),this.instance}},{key:"clear",value:function(){delete this.instance}}]),y(Re,[{key:"getApplicationKeyMap",value:function(){return Object.assign(this._globalEventStrategy.getApplicationKeyMap(),this._focusOnlyEventStrategy.getApplicationKeyMap())}},{key:"registerKeyMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._focusOnlyEventStrategy.registerKeyMap(e)}},{key:"reregisterKeyMap",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._focusOnlyEventStrategy.reregisterKeyMap(e,t)}},{key:"deregisterKeyMap",value:function(e){this._focusOnlyEventStrategy.deregisterKeyMap(e)}},{key:"registerComponentMount",value:function(e,t){return this._incrementComponentCount(),this._focusOnlyEventStrategy.registerComponentMount(e,t)}},{key:"registerComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"_incrementComponentCount",value:function(){var e=this,t=this.mountedComponentsCount;this.mountedComponentsCount+=1,0===t&&1===this.mountedComponentsCount&&(window.onblur=function(){return e._clearKeyHistory()})}},{key:"_decrementComponentCount",value:function(){var e=this.mountedComponentsCount;this.mountedComponentsCount-=1,1===e&&0===this.mountedComponentsCount&&delete window.onblur}},{key:"_clearKeyHistory",value:function(){this._focusOnlyEventStrategy.resetKeyCombinationHistory({force:!0}),this._globalEventStrategy.resetKeyCombinationHistory({force:!0})}},{key:"registerGlobalKeyMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._globalEventStrategy.registerKeyMap(e)}},{key:"registerGlobalComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"registerGlobalComponentMount",value:function(e,t){return this._incrementComponentCount(),this._globalEventStrategy.registerComponentMount(e,t)}},{key:"reregisterGlobalKeyMap",value:function(e,t){this._globalEventStrategy.reregisterKeyMap(e,t)}},{key:"deregisterGlobalKeyMap",value:function(e){this._globalEventStrategy.deregisterKeyMap(e)}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;return this._focusOnlyEventStrategy.enableHotKeys(e,t,n,o)}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;return this._focusOnlyEventStrategy.updateEnabledHotKeys(e,t,n,o,i)}},{key:"disableHotKeys",value:function(e,t){return this._focusOnlyEventStrategy.disableHotKeys(e,t)}},{key:"handleKeydown",value:function(e,t,n,o){if(Fe(t))return this._focusOnlyEventStrategy.handleKeydown(e,t,n,o)}},{key:"handleKeypress",value:function(e,t,n,o){if(Fe(t))return this._focusOnlyEventStrategy.handleKeypress(e,t,n,o)}},{key:"handleKeyup",value:function(e,t,n,o){if(Fe(t))return this._focusOnlyEventStrategy.handleKeyup(e,t,n,o)}},{key:"enableGlobalHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.enableHotKeys(e,t,n,o,i)}},{key:"updateEnabledGlobalHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.updateEnabledHotKeys(e,t,n,o,i)}},{key:"disableGlobalHotKeys",value:function(e){return this._globalEventStrategy.disableHotKeys(e)}},{key:"handleGlobalKeydown",value:function(e){return this._globalEventStrategy.handleKeydown(e)}},{key:"handleGlobalKeypress",value:function(e){return this._globalEventStrategy.handleKeypress(e)}},{key:"handleGlobalKeyup",value:function(e){return this._globalEventStrategy.handleKeyup(e)}},{key:"ignoreEvent",value:function(e){this._focusOnlyEventStrategy.ignoreEvent(e)}},{key:"forceObserveEvent",value:function(e){this._focusOnlyEventStrategy.forceObserveEvent(e)}},{key:"reactAppHistoryWithEvent",value:function(e,t){var n=this._focusOnlyEventStrategy.currentEvent;return n.key===e&&n.type===t?n.handled?Me:n.ignored?Oe:Pe:we}},{key:"simulatePendingKeyPressEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this._globalEventStrategy.listenersBound}}]),Re);function Re(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};h(this,Re),this.logger=e.logger||new w(I.option("logLevel")),this._focusOnlyEventStrategy=new He({configuration:e,logger:this.logger},this),this._globalEventStrategy=new Le({configuration:e,logger:this.logger},this),this.mountedComponentsCount=0}function Ue(o){var e,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};function i(e,t){return b({},n[e]||{},t[e]||{})}function r(e){return i("handlers",e)}function s(e){return i("keyMap",e)}return d(a,l.PureComponent),y(a,[{key:"getChildContext",value:function(){return{hotKeysParentId:this._id}}},{key:"render",value:function(){var e=this.props,t=(e.keyMap,e.handlers,e.allowChanges,f(e,["keyMap","handlers","allowChanges"])),n={onFocus:this._wrapFunction("onFocus",this._handleFocus),onBlur:this._wrapFunction("onBlur",this._handleBlur),tabIndex:I.option("defaultTabIndex")};return this._shouldBindKeyListeners()&&(n.onKeyDown=this._handleKeyDown,n.onKeyPress=this._handleKeyPress,n.onKeyUp=this._handleKeyUp),c.createElement(o,p({hotKeys:n},t))}},{key:"_shouldBindKeyListeners",value:function(){var e=s(this.props);return!he(e)||I.option("enableHardSequences")&&this._handlersIncludeHardSequences(e,r(this.props))}},{key:"_handlersIncludeHardSequences",value:function(t,e){return Object.keys(e).some(function(e){return!t[e]&&se.isValidKeySerialization(e)})}},{key:"_wrapFunction",value:function(t,n){var o=this;return"function"==typeof this.props[t]?function(e){o.props[t](e),n(e)}:n}},{key:"_focusTreeIdsPush",value:function(e){this._focusTreeIds||(this._focusTreeIds=[]),this._focusTreeIds.push(e)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds&&this._focusTreeIds.shift()}},{key:"_getFocusTreeId",value:function(){if(this._focusTreeIds)return this._focusTreeIds[0]}},{key:"componentDidUpdate",value:function(e){var t=qe.getInstance();if(t.reregisterKeyMap(this._id,this.props.keyMap),this._componentIsFocused()&&(this.props.allowChanges||!I.option("ignoreKeymapAndHandlerChangesByDefault"))){var n=this.props,o=n.keyMap,i=n.handlers;t.updateEnabledHotKeys(this._getFocusTreeId(),this._id,o,i,this._getComponentOptions())}}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"componentDidMount",value:function(){var e=qe.getInstance(),t=this.context.hotKeysParentId;e.registerComponentMount(this._id,t)}},{key:"_handleFocus",value:function(){var e;this.props.onFocus&&(e=this.props).onFocus.apply(e,arguments);var t=qe.getInstance().enableHotKeys(this._id,s(this.props),r(this.props),this._getComponentOptions());this._focusTreeIdsPush(t),this._focused=!0}},{key:"componentWillUnmount",value:function(){var e=qe.getInstance();e.deregisterKeyMap(this._id),e.registerComponentUnmount(),this._handleBlur()}},{key:"_handleBlur",value:function(){var e;this.props.onBlur&&(e=this.props).onBlur.apply(e,arguments),qe.getInstance().disableHotKeys(this._getFocusTreeId(),this._id)||this._focusTreeIdsShift(),this._focused=!1}},{key:"_handleKeyDown",value:function(e){qe.getInstance().handleKeydown(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyPress",value:function(e){qe.getInstance().handleKeypress(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyUp",value:function(e){qe.getInstance().handleKeyup(e,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:I.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:I.option("ignoreEventsCondition")}}}]),t=e=a,_(e,"propTypes",{keyMap:u.object,handlers:u.object,onFocus:u.func,onBlur:u.func,allowChanges:u.bool}),_(e,"contextTypes",{hotKeysParentId:u.number}),_(e,"childContextTypes",{hotKeysParentId:u.number}),t;function a(e){var t;return h(this,a),(t=m(this,v(a).call(this,e)))._handleFocus=t._handleFocus.bind(g(t)),t._handleBlur=t._handleBlur.bind(g(t)),t._handleKeyDown=t._handleKeyDown.bind(g(t)),t._handleKeyPress=t._handleKeyPress.bind(g(t)),t._handleKeyUp=t._handleKeyUp.bind(g(t)),t._componentIsFocused=t._componentIsFocused.bind(g(t)),t._id=qe.getInstance().registerKeyMap(e.keyMap),t}}function Ne(){return h(this,Ne),m(this,v(Ne).apply(this,arguments))}var Ge=Ue((d(Ne,l.Component),y(Ne,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=e.innerRef,o=e.component,i=f(e,["hotKeys","innerRef","component"]),r=o||I.option("defaultComponent");return c.createElement(r,b({},t,{ref:n},i))}}]),Ne));Ge.propTypes={innerRef:u.oneOfType([u.object,u.func])};var ze=(d(We,l.Component),y(We,[{key:"getChildContext",value:function(){return{globalHotKeysParentId:this._id}}},{key:"render",value:function(){return this.props.children||null}},{key:"componentDidUpdate",value:function(){var e=qe.getInstance();if(e.reregisterGlobalKeyMap(this._id,this.props.keyMap),this.props.allowChanges||!I.option("ignoreKeymapAndHandlerChangesByDefault")){var t=this.props,n=t.keyMap,o=t.handlers;e.updateEnabledGlobalHotKeys(this._id,n,o,this._getComponentOptions(),this._getEventOptions())}}}]),y(We,[{key:"componentDidMount",value:function(){var e=this.props,t=e.keyMap,n=e.handlers,o=this.context.globalHotKeysParentId,i=qe.getInstance();i.registerGlobalComponentMount(this._id,o),i.enableGlobalHotKeys(this._id,t,n,this._getComponentOptions(),this._getEventOptions())}},{key:"componentWillUnmount",value:function(){var e=qe.getInstance();e.deregisterGlobalKeyMap(this._id),e.disableGlobalHotKeys(this._id),e.registerGlobalComponentUnmount()}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:I.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:I.option("ignoreEventsCondition")}}}]),We);function We(e){var t;return h(this,We),(t=m(this,v(We).call(this,e)))._id=qe.getInstance().registerGlobalKeyMap(e.keyMap),t}function Ve(o){var e,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},i=2<arguments.length?arguments[2]:void 0;return d(r,l.PureComponent),y(r,[{key:"render",value:function(){var e=this.props,t=(e.only,e.except,f(e,["only","except"])),n={onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:this._reloadDictionaries};return c.createElement(o,p({hotKeys:n},t))}},{key:"_reloadDictionaries",value:function(){var e=this.props,t=e.only,n=e.except;this._onlyDict=$e(t),this._exceptDict=$e(n)}},{key:"_shouldIgnoreEvent",value:function(e){var t=e.key;return he(this._onlyDict)?!!he(this._exceptDict)||!this._exceptDict[t]:he(this._exceptDict)?this._onlyDict[t]:this._onlyDict[t]&&!this._exceptDict[t]}},{key:"_handleKeyEvent",value:function(e){this._shouldIgnoreEvent(e)&&qe.getInstance()[i](e)}}]),t=e=r,_(e,"propTypes",{only:u.oneOfType([u.string,u.arrayOf(u.string)]),except:u.oneOfType([u.string,u.arrayOf(u.string)])}),_(e,"defaultProps",n),t;function r(e){var t;return h(this,r),(t=m(this,v(r).call(this,e)))._handleKeyEvent=t._handleKeyEvent.bind(g(t)),t._reloadDictionaries=t._reloadDictionaries.bind(g(t)),t}}function $e(e){return ue(e).reduce(function(t,e){var n=N(e);if(!z(n))throw new W(e);return[re,ie,x,j,te,ee].forEach(function(e){t[e(n)]=!0}),t},{})}function Ye(){return h(this,Ye),m(this,v(Ye).apply(this,arguments))}_(ze,"propTypes",{keyMap:u.object,handlers:u.object,allowChanges:u.bool}),ze.contextTypes={globalHotKeysParentId:u.number},ze.childContextTypes=ze.contextTypes;var Je=Ve((d(Ye,l.Component),y(Ye,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=f(e,["hotKeys"]),o=n.component||I.option("defaultComponent");return c.createElement(o,b({},t,n))}}]),Ye),{},"ignoreEvent");function Qe(){return h(this,Qe),m(this,v(Qe).apply(this,arguments))}var Xe=Ve((d(Qe,l.Component),y(Qe,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=f(e,["hotKeys"]),o=n.component||I.option("defaultComponent");return c.createElement(o,b({},t,n))}}]),Qe),{},"forceObserveEvent");e.GlobalHotKeys=ze,e.HotKeys=Ge,e.IgnoreKeys=Je,e.ObserveKeys=Xe,e.configure=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};I.init(e)},e.getApplicationKeyMap=function(){return qe.getInstance().getApplicationKeyMap()},e.withHotKeys=Ue,e.withIgnoreKeys=function(e){return Ve(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"ignoreEvent")},e.withObserveKeys=function(e){return Ve(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"forceObserveEvent")},Object.defineProperty(e,"__esModule",{value:!0})});
